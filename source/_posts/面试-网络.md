#### https链接过程
![](https://pic2.zhimg.com/80/v2-22c7091dfa8fb587d9f37d7c3edc387d_1440w.webp)

#### 如何预防https中间人攻击

要预防HTTPS中间人攻击，可以采取以下措施：

1. 使用可信任的证书：确保通过HTTPS连接时使用的证书是由可信任的证书颁发机构（CA）颁发的。不要使用自签名证书或未经验证的证书，因为中间人攻击者可以伪造这些证书来进行攻击。

2. 使用公钥固定（Public Key Pinning）：公钥固定是一种安全机制，用于验证服务器的公钥是否与预期的公钥匹配。通过将服务器的公钥的指纹或哈希值固定在客户端上，可以防止攻击者使用伪造的证书进行中间人攻击。

3. 使用证书透明度（Certificate Transparency）：证书透明度是一种公开记录和监控SSL证书的机制。通过监控证书透明度日志，可以及时发现和报告任何潜在的恶意证书或中间人攻击。

4. 确保安全的网络环境：在使用HTTPS连接时，确保您的网络环境是安全的，避免在公共或不受信任的Wi-Fi网络上进行敏感操作，因为这些网络可能容易受到中间人攻击。

5. 使用HSTS（HTTP Strict Transport Security）：HSTS是一种安全机制，强制浏览器始终使用HTTPS与服务器进行通信。通过启用HSTS，并将网站标记为“仅使用HTTPS”，可以防止中间人攻击者将用户重定向到非加密的HTTP连接。

6. 定期更新和维护软件：确保您使用的软件和库是最新的，并及时应用安全补丁和更新。这可以帮助修复已知的安全漏洞和弱点，提高系统的安全性。

7. 培训和意识提高：对于开发人员和用户来说，提供有关中间人攻击的培训和教育非常重要。这样可以帮助他们识别和避免潜在的攻击，并采取适当的安全措施保护数据和隐私。

请记住，没有绝对安全的系统，但采取这些预防措施可以大大减少中间人攻击的风险。
#### TCP UDP 概述

UDP 是一个简单的面向数据报的传输层协议：
进程的每个输出操作都正好产生一个 UDP 数据报，并组装成一份待发送的 IP 数据报。

UDP 不提供可靠性：它把应用程序传给 IP 层的数据发送出去，但是并不保证它们能到达目的地。
应用程序必须关心 IP 数据报的长度。如果它超过网络的 MTU，那么就要对 IP 数据报进行分片。

传输层主要为两台主机上的应用程序提供端到端的通信。
在 TCP/IP 协议族中，有两个互不相同的传输协议： TCP（传输控制协议）和 UDP（用户数据报协议）。

TCP 为两台主机提供高可靠性的数据通信。
它所做的工作包括把应用程序交给它的数据分成合适的小块交给下面的网络层，
确认接收到的分组，设置发送最后确认分组的超时时钟等。
由于传输层提供了高可靠性的端到端的通信，因此应用层可以忽略所有这些细节。

而另一方面， UDP 则为应用层提供一种非常简单的服务。
它只是把称作数据报的分组从一台主机发送到另一台主机，但并不保证该数据报能到达另一端。
任何必需的可靠性必须由应用层来提供。

#### TCP 与 UDP 的区别
1. TCP 是面向连接的协议，UDP 是无连接协议
TCP 发送数据前使用三次握手建立连接，UDP 发送数据前不需要建立连接。

2. TCP 可靠，UDP 不可靠
TCP 丢包会自动重传，UDP 不会(任何必需的可靠性必须由应用层来提供)。 TCP 可靠性由三个机制保证：1. 序号（TCP 报文的序号）2. 确认（ACK 机制）3. 重传（超时或者冗余的 ACK）

3. TCP 有序，UDP 无序
消息在传输过程中可能会乱序，后发送的消息可能会先到达，TCP 会对其进行重新排序，UDP 不会。

4. TCP 无界，UDP 有界TCP 通过字节流传输，UDP 中每一个包都是单独的。

5. TCP 有流量控制（拥塞控制），UDP 没有
TCP 协议的流量控制是基于滑窗协议实现的。 拥塞控制和流量控制不同，流量控制是点对点的通信量抑制，抑制发送端发送速率，使得接收端来得及接收。

6. TCP 传输慢，UDP 传输快；
因为 TCP 需要建立连接、保证可靠性和有序性，所以比较耗时。 这就是为什么视频流、广播电视、在线多媒体游戏等选择使用 UDP。

7. TCP 是重量级的，UDP 是轻量级的
TCP 要建立连接、保证可靠性和有序性，就会传输更多的信息，如 TCP 的包头比较大。

8. TCP 的 头部比 UDP 大

OSI七层模型
![](https://pic2.zhimg.com/80/v2-436927a69a3574532059a78623d3095d_1440w.webp)

	* 物理层：RJ45、CLOCK、IEEE802.3 （中继器，集线器）
	* 数据链路：PPP、FR、HDLC、VLAN、MAC （网桥，交换机）
	* 网络层：IP、ICMP、ARP、RARP、OSPF、IPX、RIP、IGRP、 （路由器）
	* 传输层：TCP、UDP、SPX
	* 会话层：NFS、SQL、NETBIOS、RPC
	* 表示层：JPEG、MPEG、ASII
	* 应用层：FTP、DNS、Telnet、SMTP、HTTP、WWW、NFS
* 每一层的作用如下：
	* 物理层：通过媒介传输比特,确定机械及电气规范（比特Bit）
	* 数据链路层：将比特组装成帧和点到点的传递（帧Frame）
	* 网络层：负责数据包从源到宿的传递和网际互连（包PackeT）
	* 传输层：提供端到端的可靠报文传递和错误恢复（段Segment）
	* 会话层：建立、管理和终止会话（会话协议数据单元SPDU）
	* 表示层：对数据进行翻译、加密和压缩（表示协议数据单元PPDU）
	* 应用层：允许访问OSI环境的手段（应用协议数据单元APDU）

+ 网桥：工作在数据链路层，在不同或相同类型的LAN之间存储并转发数据帧，必要时进行链路层上的协议转换。可连接两个或多个网络，在其中传送信息包。


+ 交换机：工作在数据链路层，原理等同于多端口网桥。作用是连接数个相同网段的不同主机，减少网内冲突，隔离冲突域。利用存储转发和过滤技术来从物理上分割网段。


+ 路由器：工作在网络层，在不同的网络间存储并转发分组。可在异种网络之间（即不同类型的局域网互连，局域网与广域网，广域网与广域网）传输数据并进行路径选择，使用专门的软件协议从逻辑上对整个网络进行划分。


+ 网关：对高层协议（包括传输层及更高层次）进行转换的网间连接器。允许使用不兼容的协议，比如SPX/IPX和TCP/IP的系统和网络互连。因为协议转换是网关最重要的功能，所以答案是工作在传输层及以上层次。


+ 网卡：在物理层上网卡主要是完成物理接口的连接,电信号的传送以及将数据分解为适当大小的数据包之后向网络上发送的功能. 数据链路层功能包括链路建立和拆除，帧定界同步顺序差错控制这些。大多认为主要工作在物理层。



#### 三次握手（Three-way Handshake）：

第一步：客户端向服务器发送一个带有SYN（同步）标志的连接请求报文段，表示客户端希望建立连接。该报文段包含一个随机的初始序列号（ISN）。
第二步：服务器收到客户端的连接请求后，回复一个带有SYN和ACK（确认）标志的报文段。该报文段中的SYN是对客户端的请求的确认，ACK表示服务器已经接受了客户端的请求，并生成了自己的初始序列号（ISN）。
第三步：客户端收到服务器的确认后，再发送一个带有ACK标志的报文段，确认服务器的确认。至此，TCP连接建立成功，双方可以开始传输数据。

#### 四次挥手（Four-way Handshake）：

TCP的四次挥手是指在TCP连接的关闭过程中，客户端和服务器之间进行的一系列步骤。它用于确保双方都完成了数据传输并且安全地关闭连接。下面是TCP的四次挥手详细步骤：

+ 第一步（客户端发送FIN）：客户端首先发送一个带有FIN（Finish）标志的TCP报文段给服务器，表示客户端不再发送数据。客户端进入FIN_WAIT_1状态。

+ 第二步（服务器发送ACK）：服务器收到客户端的FIN后，发送一个确认ACK（Acknowledgment）报文段给客户端，表示已收到了客户端的关闭请求。服务器进入CLOSE_WAIT状态，而客户端进入FIN_WAIT_2状态。

+ 第三步（服务器发送FIN）：当服务器不再发送数据时，它会向客户端发送一个带有FIN标志的TCP报文段，表示服务器准备关闭连接。服务器进入LAST_ACK状态。

+ 第四步（客户端发送ACK）：客户端收到服务器的FIN后，发送一个确认ACK报文段给服务器，表示已收到了服务器的关闭请求。客户端进入TIME_WAIT状态。

在TIME_WAIT状态，客户端等待一段时间（通常是两倍的最大报文段生存时间，也称为MSL），1.以确保服务器收到了最后一个ACK，2.保证本连接持续时间内的报文自然消亡。在等待期间，客户端保持连接的信息，以防止来自之前连接的延迟报文段干扰新的连接。

在完成四次挥手后，客户端和服务器都进入了CLOSED状态，连接正式关闭。

TCP的四次挥手过程可以确保双方都能正常关闭连接，并且在关闭之前完成数据的传输和确认。这样可以避免数据丢失或不完整的情况，确保网络通信的可靠性。


#### HTTP

#### 1. HTTP/0.9 只有一个命令 `GET`, HTTP/1.0 引入了 `POST` 命令和 `HEAD` 命令，丰富了浏览器与服务器的互动手段。请问 HTTP/1.1 的请求方法有哪些？

**答**：HTTP/1.1 提供八种方法以不同的方式操作指定的资源。分别是

1. OPTIONS：这个方法可使服务器传回该资源所支持的所有HTTP请求方法。用'\*'来代替资源名称，向Web服务器发送OPTIONS请求，可以测试服务器功能是否正常运作。
2. HEAD：与GET方法一样，都是向服务器发出指定资源的请求。只不过服务器将不传回资源的本文部分。它的好处在于，使用这个方法可以在不必传输全部内容的情况下，就可以获取其中“关于该资源的信息”（元信息或称元数据）。
3. GET：向指定的资源发出“显示”请求。使用GET方法应该只用在读取数据，而不应当被用于产生“副作用”的操作中，例如在Web Application中。其中一个原因是GET可能会被网络蜘蛛等随意访问。参见安全方法
4. POST：向指定资源提交数据，请求服务器进行处理（例如提交表单或者上传文件）。数据被包含在请求本文中。这个请求可能会创建新的资源或修改现有资源，或二者皆有。
5. PUT：向指定资源位置上传其最新内容。
6. DELETE：请求服务器删除Request-URI所标识的资源。
7. TRACE：回显服务器收到的请求，主要用于测试或诊断。
8. CONNECT：HTTP/1.1协议中预留给能够将连接改为管道方式的代理服务器。通常用于SSL加密服务器的链接（经由非加密的HTTP代理服务器）。

#### 2. HTTP 状态码的主要类型有哪些？

**答**：状态代码的第一个数字代表当前响应的类型，主要为五类

1. 1xx消息——请求已被服务器接收，继续处理
2. 2xx成功——请求已成功被服务器接收、理解、并接受
3. 3xx重定向——需要后续操作才能完成这一请求
4. 4xx请求错误——请求含有词法错误或者无法被执行
5. 5xx服务器错误——服务器在处理某个正确请求时发生错误

详细情况见 [维基百科](https://zh.wikipedia.org/wiki/HTTP%E7%8A%B6%E6%80%81%E7%A0%81)。

#### 3. TCP 协议中为什么连接的时候是三次握手，关闭的时候却是四次握手？

**答**：因为当Server端收到Client端的SYN连接请求报文后，可以直接发送SYN+ACK报文。其中ACK报文是用来应答的，SYN报文是用来同步的。但是关闭连接时，当Server端收到FIN报文时，很可能并不会立即关闭SOCKET，所以只能先回复一个ACK报文，告诉Client端，"你发的FIN报文我收到了"。只有等到我Server端所有的报文都发送完了，我才能发送FIN报文，因此不能一起发送。故需要四步握手。

#### 4. HTTPS 建立连接的过程？

**答**：按照通信过程的收发端来划分，可以将整个过程分成四个部分-客户端请求、服务端回复、客户端回应以及服务器回应。

1. 客户端发出握手请求 (Client Hello)，包含以下信息：
	* 支持的协议版本，比如TLS 1.0
	* 一个客户端生成的随机数(random\_1)，这个随机数既需要客户端保存又需要发送给服务器
	* 支持的加密方法，比如RSA公钥加密
	* 支持的压缩方法
2. 服务器回复 (Server Hello)，包含以下信息：
	* 确认使用的加密通信协议版本，比如TLS 1.0。如果浏览器与服务器支持的版本不一致，服务器关闭加密通信
	* 一个服务器生成的随机数 (random\_2)
	* 确认使用的加密方法，比如RSA公钥加密
	* 服务器证书（其中包含服务器放入公钥）
	* 可选：如果服务器需要确认客户端的身份，就会再包含一项请求，要求客户端提供”客户端证书”。比如，金融机构往往只允许认证客户连入自己的网络，就会向正式客户提供USB密钥，里面就包含了一张客户端证书
3. 客户端回应，包含以下步骤：
	* 验证服务器证书的合法性，证书合法性包括：证书是否过期，发行服务器证书的 CA 是否可靠，发行者证书的公钥能否正确解开服务器证书的“发行者的数字签名”，服务器证书上的域名是否和服务器的实际域名相匹配。如果合法性验证没有通过，通讯将断开
	* 客户端使用一些加密算法 (例如：RSA, Diffie-Hellman)产生一个48个字节的 key，这个 key 叫 PreMaster Secret。该 PreMaster Secret 用服务器发来的公钥加密后随同相关内容（如果前一步，服务器要求客户端证书，客户端会在这一步发送证书及相关信息，即客户的证书以及含有签名的随机数）传送回服务器端，防止被窃听
	* 编码改变通知，表示随后的信息都将用双方商定的加密方法和密钥发送
	* 客户端握手结束通知，表示客户端的握手阶段已经结束。这一项同时也是前面发送的所有内容的hash值，用来供服务器校验
4. 服务器回应，服务器接收到浏览器送过来的消息，用自己的私钥解密，获得 PreMaster Secret。再结合另外两个随机数 random\_1 和 random\_2，计算出本次会话的会话密钥 (session secret)，然后向客户端发送下面信息：
	* 编码改变通知，表示随后的信息都将用双方商定的加密方法和密钥发送
	* 服务器握手结束通知，表示服务器的握手阶段已经结束。这一项同时也是前面发送的所有内容的hash值，用来供客户端校验

在四个过程结束之后，握手阶段结束。接下来，客户端和服务端进入加密通信阶段，该阶段的通信采用普通的 HTTP 协议，只不过双方都采用相同的会话密钥对会话内容进行对称加密和解密。

需要注意的是非对称加解密算法的效率要比对称加解密要低的多。所以 SSL 在握手过程中使用非对称密码算法来协商密钥，实际使用对称加解密的方法对 HTTP 内容加密传输。下图为 SSL 连接建立过程详解图。

![SSL 连接建立过程详解图](https://xuyonglinblog.oss-cn-beijing.aliyuncs.com/SSL-Connection-Setup.png")

#### 5. IP 地址的分类？

**答**：A 类地址：以0开头， 第一个字节范围：0~126（1.0.0.0 - 126.255.255.255）；B 类地址：以10开头， 第一个字节范围：128~191（128.0.0.0 - 191.255.255.255）；C 类地址：以110开头， 第一个字节范围：192~223（192.0.0.0 - 223.255.255.255）。其中，10.0.0.0—10.255.255.255，172.16.0.0—172.31.255.255，192.168.0.0—
192.168.255.255 为 Internet 上保留地址用于内部。

#### 6. 互联网上各类协议的介绍？

**答**：

1. ICMP协议： 因特网控制报文协议。它是TCP/IP协议族的一个子协议，用于在IP主机、路由器之间传递控制消息。
2. TFTP协议： 是TCP/IP协议族中的一个用来在客户机与服务器之间进行简单文件传输的协议，提供不复杂、开销不大的文件传输服务。
3. HTTP协议： 超文本传输协议，是一个属于应用层的面向对象的协议，由于其简捷、快速的方式，适用于分布式超媒体信息系统。
4. DHCP协议： 动态主机配置协议，是一种让系统得以连接到网络上，并获取所需要的配置参数手段。
NAT协议：网络地址转换属接入广域网(WAN)技术，是一种将私有（保留）地址转化为合法IP地址的转换技术。
5. DHCP协议：一个局域网的网络协议，使用UDP协议工作，用途：给内部网络或网络服务供应商自动分配IP地址，给用户或者内部网络管理员作为对所有计算机作中央管理的手段。

#### 7. TCP 和 UDP 的区别？

**答**：TCP 提供面向连接的、可靠的数据流传输，而 UDP 提供的是非面向连接的、不可靠的数据流传输；TCP 传输单位称为 TCP 报文段，UDP 传输单位称为用户数据报；TCP 注重数据安全性，UDP 数据传输快，因为不需要连接等待，少了许多操作，但是其安全性却一般；TCP 对应的协议和 UDP 对应的协议如下：

```
TCP 协议
（1） FTP：定义了文件传输协议，使用21端口。
（2） Telnet：一种用于远程登陆的端口，使用23端口，用户可以以自己的身份远程连接到计算机上，可提供基于DOS模式下的通信服务。
（3） SMTP：邮件传送协议，用于发送邮件。服务器开放的是25号端口。
（4） POP3：它是和SMTP对应，POP3用于接收邮件。POP3协议所用的是110端口。
（5）HTTP：是从Web服务器传输超文本到本地浏览器的传送协议。
UDP协议
（1） DNS：用于域名解析服务，将域名地址转换为IP地址。DNS用的是53号端口。
（2） SNMP：简单网络管理协议，使用161号端口，是用来管理网络设备的。由于网络设备很多，无连接的服务就体现出其优势。
（3） TFTP(Trival File Tran敏感词er Protocal)，简单文件传输协议，该协议在熟知端口69上使用UDP服务。
```

#### 三次握手（Three-way Handshake）：

第一步：客户端向服务器发送一个带有SYN（同步）标志的连接请求报文段，表示客户端希望建立连接。该报文段包含一个随机的初始序列号（ISN）。
第二步：服务器收到客户端的连接请求后，回复一个带有SYN和ACK（确认）标志的报文段。该报文段中的SYN是对客户端的请求的确认，ACK表示服务器已经接受了客户端的请求，并生成了自己的初始序列号（ISN）。
第三步：客户端收到服务器的确认后，再发送一个带有ACK标志的报文段，确认服务器的确认。至此，TCP连接建立成功，双方可以开始传输数据。

#### 四次挥手（Four-way Handshake）：

TCP的四次挥手是指在TCP连接的关闭过程中，客户端和服务器之间进行的一系列步骤。它用于确保双方都完成了数据传输并且安全地关闭连接。下面是TCP的四次挥手详细步骤：

+ 第一步（客户端发送FIN）：客户端首先发送一个带有FIN（Finish）标志的TCP报文段给服务器，表示客户端不再发送数据。客户端进入FIN_WAIT_1状态。

+ 第二步（服务器发送ACK）：服务器收到客户端的FIN后，发送一个确认ACK（Acknowledgment）报文段给客户端，表示已收到了客户端的关闭请求。服务器进入CLOSE_WAIT状态，而客户端进入FIN_WAIT_2状态。

+ 第三步（服务器发送FIN）：当服务器不再发送数据时，它会向客户端发送一个带有FIN标志的TCP报文段，表示服务器准备关闭连接。服务器进入LAST_ACK状态。

+ 第四步（客户端发送ACK）：客户端收到服务器的FIN后，发送一个确认ACK报文段给服务器，表示已收到了服务器的关闭请求。客户端进入TIME_WAIT状态。

在TIME_WAIT状态，客户端等待一段时间（通常是两倍的最大报文段生存时间，也称为MSL），以确保服务器收到了最后一个ACK。在等待期间，客户端保持连接的信息，以防止来自之前连接的延迟报文段干扰新的连接。

在完成四次挥手后，客户端和服务器都进入了CLOSED状态，连接正式关闭。

TCP的四次挥手过程可以确保双方都能正常关闭连接，并且在关闭之前完成数据的传输和确认。这样可以避免数据丢失或不完整的情况，确保网络通信的可靠性。


### HTTP 1.1：

+ 引入了持久连接（persistent connections），即在单个TCP连接上可以陆续发送多个请求和响应，只是减少链接的打开和关闭，依然是第一个请求响应之后，后面的请求才会继续
+ 支持管道化（pipelining），可以在一个TCP连接上同时发送多个请求，而无需等待每个请求的响应。
+ 引入了HTTP首部复用（header field reuse），允许在多个请求之间共享相同的头部信息。
+ 支持断点续传（byte serving）和范围请求（range requests）。
+ 引入了更多的请求方法，如OPTIONS、DELETE等。

### HTTP 2.0：

+ 引入了二进制传输，将HTTP报文分解为二进制帧进行传输，提高了传输效率。
+ 支持多路复用（multiplexing），在单个TCP连接上同时发送多个请求和响应，避免了HTTP 1.x中的队头阻塞问题。
+ 使用头部压缩（header compression）减少了传输的头部大小。
+ 引入了服务器推送（server push），允许服务器在客户端请求之前主动推送资源。
+ 支持优先级和流控制，可以根据资源的重要性进行流量控制。

总体而言，随着HTTP版本的不断演进，协议变得更加高效、灵活和可扩展，提供了更多的功能和性能优化，以满足不断增长的Web应用需求。HTTP 2.0相对于之前的版本带来了更大的改进，尤其是在性能和并发处理方面。

### http3.0

+ 解决了队头阻塞问题： 在HTTP/2中，当一个数据流丢失数据包时，所有活动的数据流都会经历停顿，这就是“头部阻塞”问题。而QUIC协议的多路复用机制允许多个数据流在同一个连接上并行传输，即使其中一个数据流出现了问题，其他数据流也不会受到影响，从而避免了“头部阻塞”问题的发生

+ 0 RTT：DH密钥协商需要通行双方各自生成自己的非对称公私钥对。server端与客户端的关系是1对N的关系,明显server端生成一份公私钥对, 让N个客户端公用, 能明显减少生成开销, 降低管理的成本。server端的这份公私钥对就是专门用于握手使用的, 客户端一经获取,就可以缓存下来后续建连时继续使用, 这个就是达成0-RTT握手的关键, 因此server生成的这份公钥称为0-RTT握手公钥。值得一提的是server端会再次生成一份临时的公私钥对，使用这份临时的私钥与客户端的公钥运算出最终的会话对称密钥，为了获取所谓的前向安全特性: 因为server端的后面生成的这份公私钥是临时生成的,不会保存下来，也就杜绝了密钥泄漏导致会话数据被恶意收集后的被解密掉的风险

+ 更优的拥塞控制：目前的 QUIC 的拥塞控制主要实现了 TCP 的慢启动，拥塞避免，快重传，快恢复。在这些拥塞控制算法的基础上，再进行改进。

	比如单调递增的 Packet Number。TCP 使用了基于字节序号 Sequence Number 和 ACK 来保证消息的有序到达。但是 Sequence Number 在重传的时候有二义性。你不知道下一个 ACK 是上一次请求的响应还是这次重传的响应。而单调递增的 Packet Number 可以避免这个问题，保证采样 RTT(数据从一端到另一端的往返时间) 的准确。

	> 具体改进可以参考[这篇文章](https://zhuanlan.zhihu.com/p/32553477)

	QUIC 拥塞控制算法主要重新实现了一遍 TCP 的算法，毕竟 TCP 的算法是经过几十年的生产验证的。