#### https链接过程
![](https://pic2.zhimg.com/80/v2-22c7091dfa8fb587d9f37d7c3edc387d_1440w.webp)

#### 如何预防https中间人攻击

要预防HTTPS中间人攻击，可以采取以下措施：

1. 使用可信任的证书：确保通过HTTPS连接时使用的证书是由可信任的证书颁发机构（CA）颁发的。不要使用自签名证书或未经验证的证书，因为中间人攻击者可以伪造这些证书来进行攻击。

2. 使用公钥固定（Public Key Pinning）：公钥固定是一种安全机制，用于验证服务器的公钥是否与预期的公钥匹配。通过将服务器的公钥的指纹或哈希值固定在客户端上，可以防止攻击者使用伪造的证书进行中间人攻击。

3. 使用证书透明度（Certificate Transparency）：证书透明度是一种公开记录和监控SSL证书的机制。通过监控证书透明度日志，可以及时发现和报告任何潜在的恶意证书或中间人攻击。

4. 确保安全的网络环境：在使用HTTPS连接时，确保您的网络环境是安全的，避免在公共或不受信任的Wi-Fi网络上进行敏感操作，因为这些网络可能容易受到中间人攻击。

5. 使用HSTS（HTTP Strict Transport Security）：HSTS是一种安全机制，强制浏览器始终使用HTTPS与服务器进行通信。通过启用HSTS，并将网站标记为“仅使用HTTPS”，可以防止中间人攻击者将用户重定向到非加密的HTTP连接。

6. 定期更新和维护软件：确保您使用的软件和库是最新的，并及时应用安全补丁和更新。这可以帮助修复已知的安全漏洞和弱点，提高系统的安全性。

7. 培训和意识提高：对于开发人员和用户来说，提供有关中间人攻击的培训和教育非常重要。这样可以帮助他们识别和避免潜在的攻击，并采取适当的安全措施保护数据和隐私。

请记住，没有绝对安全的系统，但采取这些预防措施可以大大减少中间人攻击的风险。
#### TCP UDP 概述

UDP 是一个简单的面向数据报的传输层协议：
进程的每个输出操作都正好产生一个 UDP 数据报，并组装成一份待发送的 IP 数据报。

UDP 不提供可靠性：它把应用程序传给 IP 层的数据发送出去，但是并不保证它们能到达目的地。
应用程序必须关心 IP 数据报的长度。如果它超过网络的 MTU，那么就要对 IP 数据报进行分片。

传输层主要为两台主机上的应用程序提供端到端的通信。
在 TCP/IP 协议族中，有两个互不相同的传输协议： TCP（传输控制协议）和 UDP（用户数据报协议）。

TCP 为两台主机提供高可靠性的数据通信。
它所做的工作包括把应用程序交给它的数据分成合适的小块交给下面的网络层，
确认接收到的分组，设置发送最后确认分组的超时时钟等。
由于传输层提供了高可靠性的端到端的通信，因此应用层可以忽略所有这些细节。

而另一方面， UDP 则为应用层提供一种非常简单的服务。
它只是把称作数据报的分组从一台主机发送到另一台主机，但并不保证该数据报能到达另一端。
任何必需的可靠性必须由应用层来提供。

#### TCP 与 UDP 的区别
1. TCP 是面向连接的协议，UDP 是无连接协议
TCP 发送数据前使用三次握手建立连接，UDP 发送数据前不需要建立连接。

2. TCP 可靠，UDP 不可靠
TCP 丢包会自动重传，UDP 不会(任何必需的可靠性必须由应用层来提供)。 TCP 可靠性由三个机制保证：1. 序号（TCP 报文的序号）2. 确认（ACK 机制）3. 重传（超时或者冗余的 ACK）

3. TCP 有序，UDP 无序
消息在传输过程中可能会乱序，后发送的消息可能会先到达，TCP 会对其进行重新排序，UDP 不会。

4. TCP 无界，UDP 有界TCP 通过字节流传输，UDP 中每一个包都是单独的。

5. TCP 有流量控制（拥塞控制），UDP 没有
TCP 协议的流量控制是基于滑窗协议实现的。 拥塞控制和流量控制不同，流量控制是点对点的通信量抑制，抑制发送端发送速率，使得接收端来得及接收。

6. TCP 传输慢，UDP 传输快；
因为 TCP 需要建立连接、保证可靠性和有序性，所以比较耗时。 这就是为什么视频流、广播电视、在线多媒体游戏等选择使用 UDP。

7. TCP 是重量级的，UDP 是轻量级的
TCP 要建立连接、保证可靠性和有序性，就会传输更多的信息，如 TCP 的包头比较大。

8. TCP 的 头部比 UDP 大

OSI七层模型
![](https://pic2.zhimg.com/80/v2-436927a69a3574532059a78623d3095d_1440w.webp)

	* 物理层：RJ45、CLOCK、IEEE802.3 （中继器，集线器）
	* 数据链路：PPP、FR、HDLC、VLAN、MAC （网桥，交换机）
	* 网络层：IP、ICMP、ARP、RARP、OSPF、IPX、RIP、IGRP、 （路由器）
	* 传输层：TCP、UDP、SPX
	* 会话层：NFS、SQL、NETBIOS、RPC
	* 表示层：JPEG、MPEG、ASII
	* 应用层：FTP、DNS、Telnet、SMTP、HTTP、WWW、NFS
* 每一层的作用如下：
	* 物理层：通过媒介传输比特,确定机械及电气规范（比特Bit）
	* 数据链路层：将比特组装成帧和点到点的传递（帧Frame）
	* 网络层：负责数据包从源到宿的传递和网际互连（包PackeT）
	* 传输层：提供端到端的可靠报文传递和错误恢复（段Segment）
	* 会话层：建立、管理和终止会话（会话协议数据单元SPDU）
	* 表示层：对数据进行翻译、加密和压缩（表示协议数据单元PPDU）
	* 应用层：允许访问OSI环境的手段（应用协议数据单元APDU）

+ 网桥：工作在数据链路层，在不同或相同类型的LAN之间存储并转发数据帧，必要时进行链路层上的协议转换。可连接两个或多个网络，在其中传送信息包。


+ 交换机：工作在数据链路层，原理等同于多端口网桥。作用是连接数个相同网段的不同主机，减少网内冲突，隔离冲突域。利用存储转发和过滤技术来从物理上分割网段。


+ 路由器：工作在网络层，在不同的网络间存储并转发分组。可在异种网络之间（即不同类型的局域网互连，局域网与广域网，广域网与广域网）传输数据并进行路径选择，使用专门的软件协议从逻辑上对整个网络进行划分。


+ 网关：对高层协议（包括传输层及更高层次）进行转换的网间连接器。允许使用不兼容的协议，比如SPX/IPX和TCP/IP的系统和网络互连。因为协议转换是网关最重要的功能，所以答案是工作在传输层及以上层次。


+ 网卡：在物理层上网卡主要是完成物理接口的连接,电信号的传送以及将数据分解为适当大小的数据包之后向网络上发送的功能. 数据链路层功能包括链路建立和拆除，帧定界同步顺序差错控制这些。大多认为主要工作在物理层。



#### 三次握手（Three-way Handshake）：

第一步：客户端向服务器发送一个带有SYN（同步）标志的连接请求报文段，表示客户端希望建立连接。该报文段包含一个随机的初始序列号（ISN）。
第二步：服务器收到客户端的连接请求后，回复一个带有SYN和ACK（确认）标志的报文段。该报文段中的SYN是对客户端的请求的确认，ACK表示服务器已经接受了客户端的请求，并生成了自己的初始序列号（ISN）。
第三步：客户端收到服务器的确认后，再发送一个带有ACK标志的报文段，确认服务器的确认。至此，TCP连接建立成功，双方可以开始传输数据。

#### 四次挥手（Four-way Handshake）：

TCP的四次挥手是指在TCP连接的关闭过程中，客户端和服务器之间进行的一系列步骤。它用于确保双方都完成了数据传输并且安全地关闭连接。下面是TCP的四次挥手详细步骤：

+ 第一步（客户端发送FIN）：客户端首先发送一个带有FIN（Finish）标志的TCP报文段给服务器，表示客户端不再发送数据。客户端进入FIN_WAIT_1状态。

+ 第二步（服务器发送ACK）：服务器收到客户端的FIN后，发送一个确认ACK（Acknowledgment）报文段给客户端，表示已收到了客户端的关闭请求。服务器进入CLOSE_WAIT状态，而客户端进入FIN_WAIT_2状态。

+ 第三步（服务器发送FIN）：当服务器不再发送数据时，它会向客户端发送一个带有FIN标志的TCP报文段，表示服务器准备关闭连接。服务器进入LAST_ACK状态。

+ 第四步（客户端发送ACK）：客户端收到服务器的FIN后，发送一个确认ACK报文段给服务器，表示已收到了服务器的关闭请求。客户端进入TIME_WAIT状态。

在TIME_WAIT状态，客户端等待一段时间（通常是两倍的最大报文段生存时间，也称为MSL），1.以确保服务器收到了最后一个ACK，2.保证本连接持续时间内的报文自然消亡。在等待期间，客户端保持连接的信息，以防止来自之前连接的延迟报文段干扰新的连接。

在完成四次挥手后，客户端和服务器都进入了CLOSED状态，连接正式关闭。

TCP的四次挥手过程可以确保双方都能正常关闭连接，并且在关闭之前完成数据的传输和确认。这样可以避免数据丢失或不完整的情况，确保网络通信的可靠性。
